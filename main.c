/*
Autor: Marcio Scardua

Manipulacao display led matricial 8x4
*/
#include <stdio.h>
#include "def_pinos.h"
#include "config.c"

volatile __bit fbr = 0;

__code unsigned char caracter[44][4] = {	
//0	
{0xff,0x81,0x81,0xff},
//1	
{0x84,0x82,0xff,0x80},
//2	
{0xe2,0x91,0x89,0x86},
//3	
{0x89,0x89,0x89,0x76},
//4	
{0x0f,0x08,0x08,0xff},
//5	
{0x8f,0x89,0x89,0x71},
//6	
{0x78,0x94,0x92,0x61},
//7	
{0x81,0x21,0x09,0x03},
//8	
{0x76,0x89,0x89,0x76},
//9	
{0x46,0x89,0x89,0x7e},
//:	
{0x00,0x66,0x66,0x00},
//;	
{0x00,0xb6,0x76,0x00},
//<	
{0x10,0x28,0x44,0x82},
//=	
{0x24,0x24,0x24,0x24},
//>	
{0x82,0x44,0x28,0x10},
//?	
{0x02,0xb1,0x09,0x06},
//@	
{0x7e,0x9d,0x95,0x5e},
//A	
{0xfe,0x11,0x11,0xfe},
//B	
{0xff,0x89,0x89,0x76},
//C	
{0x7e,0x81,0x81,0x81},
//D	
{0xff,0x81,0x42,0x18},
//E	
{0xff,0x99,0x99,0x99},
//F	
{0xff,0x11,0x11,0x01},
//G	
{0x7e,0x89,0x89,0x72},
//H	
{0xff,0x18,0x18,0xff},
//I	
{0x81,0xff,0xff,0x81},
//J	
{0x41,0x81,0x7f,0x01},
//K	
{0xff,0x18,0x24,0x42},
//L	
{0xff,0x80,0x80,0x80},
//M	
{0xff,0x06,0x06,0xff},
//N	
{0xff,0x0e,0x70,0xff},
//O	
{0x7e,0x81,0x81,0x7e},
//P	
{0xff,0x09,0x09,0x06},
//Q	
{0x7e,0x81,0xc1,0xfe},
//R	
{0xff,0x31,0x51,0x8e},
//S	
{0x46,0x89,0x91,0x62},
//T	
{0x01,0xff,0xff,0x01},
//U	
{0x7f,0x80,0x80,0x7f},
//V	
{0x3f,0x40,0x80,0x7f},
//W	
{0xff,0x60,0x60,0xff},
//X  
{0xe7,0x18,0x18,0xe7},
//Y	
{0x0f,0xf0,0xf0,0x0f},
//Z	
{0xe1,0x91,0x89,0x87},
//cheio	
{0xff,0xff,0xff,0xff}

};

void delay_ms(unsigned int t){
	TMOD |= 0x01;
	TMOD &= ~0x02;
	for(;t>0;t--){
		TR0=0;
		TF0=0;
		TL0=0x58;
		TH0=0x9e;
		TR0=1;
		while(TF0==0);
	}
}


void mostra_caracter(unsigned char codigo){
	unsigned char linha;
	if((codigo > 47) && (codigo < 91))
		linha = codigo-48;
	else
		linha = 43;
	P0 = caracter[linha][0];
	P1 = caracter[linha][1];
	P2 = caracter[linha][2];
	P3 = caracter[linha][3];
}

void print_leds(unsigned char * ponteiro){
	unsigned char i = 0;
	while(ponteiro[i] != 0){
		mostra_caracter(ponteiro[i]);
		i++;
		delay_ms(500);
	}
}
void interrupcao_serial(void) __interrupt 4{
	if(RI0 == 1){
		fbr = 1;
		RI0 = 0;		
	}
}
void putchar(char c){
    SBUF0 = c;
    while(TI0 == 0); 
    TI0 = 0;
}
void main(void){
    Init_Device();
    SFRPAGE = LEGACY_PAGE;
	
	while(1){
		if(fbr == 1){
			fbr = 0;
			switch(SBUF0){
				case 'n'://solicita nome
				mostra_caracter('M');
				delay_ms(500);
				mostra_caracter('A');
				delay_ms(500);
				mostra_caracter('R');
				delay_ms(500);
				mostra_caracter('C');
				delay_ms(500);
				mostra_caracter('I');
				delay_ms(500);
				mostra_caracter('O');
				delay_ms(500);	
									
				printf_fast_f("Matriz Nome");				
				break;

				case 'm'://microcontroladores
				print_leds("MICROCONTROLADORES");
									
				printf_fast_f("Matriz microcontroladores");				
				break;
			}
		}	
		
	}

}